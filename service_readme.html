<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GEOPM Service &mdash; GEOPM  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Guide to Service Installation" href="install.html" />
    <link rel="prev" title="Guide for Service Users" href="service.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> GEOPM
            <img src="https://geopm.github.io/images/geopm-logo-clear.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="service.html">Guide for Service Users</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">GEOPM Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#penguin-linux-integration">🐧 Linux Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#telescope-hardware-telemetry">🔭 Hardware Telemetry</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gear-hardware-configuration">⚙️ Hardware Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#medal-sports-quality-of-service">🏅 Quality of Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lock-security">🔒 Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rocket-performance">🚀 Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jigsaw-extensibility">🧩 Extensibility</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#signals-and-controls">Signals and Controls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#access-management">Access Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opening-a-session">Opening a Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="#batch-server">Batch Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Guide to Service Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="requires.html">Guide to Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="build.html">Guide to Source Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Guide to Service Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin.html">Guide for Service Administrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="client.html">Guide for Service Clients</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Guide for HPC Runtime Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Guide for Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel.html">Guide for GEOPM Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Manual</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GEOPM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="service.html">Guide for Service Users</a> &raquo;</li>
      <li>GEOPM Service</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/service_readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="geopm-service">
<h1>GEOPM Service<a class="headerlink" href="#geopm-service" title="Permalink to this heading"></a></h1>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<div class="section" id="penguin-linux-integration">
<h3>🐧 Linux Integration<a class="headerlink" href="#penguin-linux-integration" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Linux Systemd Service with DBus interface for user-level access to
hardware features on heterogeneous systems</p>
</div></blockquote>
</div>
<div class="section" id="telescope-hardware-telemetry">
<h3>🔭 Hardware Telemetry<a class="headerlink" href="#telescope-hardware-telemetry" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Users read telemetry from hardware components on heterogeneous
systems with a vendor agnostic interface</p>
</div></blockquote>
</div>
<div class="section" id="gear-hardware-configuration">
<h3>⚙️ Hardware Configuration<a class="headerlink" href="#gear-hardware-configuration" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Users configure hardware component device settings on heterogeneous
systems with a vendor agnostic interface</p>
</div></blockquote>
</div>
<div class="section" id="medal-sports-quality-of-service">
<h3>🏅 Quality of Service<a class="headerlink" href="#medal-sports-quality-of-service" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>GEOPM Service reverts any changes made to hardware configurations
after the client's Linux process session ends</p>
</div></blockquote>
</div>
<div class="section" id="lock-security">
<h3>🔒 Security<a class="headerlink" href="#lock-security" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Linux system administrators manage fine-grained access permissions
for capabilities exposed by the GEOPM Service</p>
</div></blockquote>
</div>
<div class="section" id="rocket-performance">
<h3>🚀 Performance<a class="headerlink" href="#rocket-performance" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Users may call a DBus interface to create a batch server which
provides a lower-latency interface with a single permissions
validation when server is created</p>
</div></blockquote>
</div>
<div class="section" id="jigsaw-extensibility">
<h3>🧩 Extensibility<a class="headerlink" href="#jigsaw-extensibility" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Supports extensibility for heterogeneous environments through C++
plugin infrastructure (IOGroups).</p>
</div></blockquote>
</div>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The GEOPM Service provides a user-level interface to read telemetry
and configure settings of heterogeneous hardware platforms. Linux
system administrators may manage permissions for user access to
telemetry and configuration at a fine granularity.</p>
<p>Clients use the GEOPM Service DBus interface to interact with the
service.  The GEOPM Service package provides access to the DBus
interfaces from the command line, or programatically with library
interfaces for C, C++ and Python.</p>
<p>The service supports many simultaneous client sessions that make
measurements, but only clients from within one Linux process session
are granted write permission to configure hardware control values at
any time.  When a client process session is granted write access it
will retain that permission until the Linux session process leader of
that client process terminates.  When the process session leader
terminates, all hardware settings that are managed by the GEOPM Service
are restored to the values they had prior to the first client write
request.  See <a class="reference external" href="https://man7.org/linux/man-pages/man2/setsid.2.html">setsid(2)</a>
manual for more information about the Linux session leader process.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://geopm.github.io/pdf/geopm-service.pdf">Overview slides</a></p></li>
</ul>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this heading"></a></h2>
<a class="reference external image-reference" href="https://geopm.github.io/pdf/geopm-service-diagram.pdf"><img alt="" src="https://geopm.github.io/images/geopm-service-diagram.svg" /></a>
<p>The architecture diagram shows the relationship between the IOGroups
and the GEOPM Service.  IOGroups are the C++ classes that abstract
hardware interfaces like the LevelZeroIOGroup for interfacing with
Intel hardware through the LevelZero library API, or the MSRIOGroup
for interacting with the Model Specific Register device driver.  These
IOGroups provide a plugin mechanism for extending GEOPM.</p>
<p>The PlatformIO interface is a container for all IOGroups, and is the
primary interface for users interacting with hardware through GEOPM.
The PlatformIO interface may be accessed through language bindings
with Python, C, and C++ as well as command line tools like
<code class="docutils literal notranslate"><span class="pre">geopmread</span></code> and <code class="docutils literal notranslate"><span class="pre">geopmwrite</span></code>.  The GEOPM DBus interface,
<code class="docutils literal notranslate"><span class="pre">io.github.geopm</span></code>, provides the secure gateway to privileged
PlatformIO features.  The administrator uses the <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code>
command line tool to configure the DBus interface to enable user level
access to any subset of the privileged PlatformIO features.</p>
</div>
<div class="section" id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this heading"></a></h2>
<p>The GEOPM systemd service is a new feature for version 2.0.  The
feature is fully tested and production ready.</p>
</div>
<div class="section" id="signals-and-controls">
<h2>Signals and Controls<a class="headerlink" href="#signals-and-controls" title="Permalink to this heading"></a></h2>
<p>Each GEOPM signal and control has an associated name and a hardware
domain.  The name is a unique string identifier defined by the IOGroup
that provides the signal or control.  The hardware domain that
provides the interface is represented by one of the enumerations as
defined by PlatformTopo.  A detailed description of the signals and
controls available on a system can be discovered with the
<code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line tool.  The description includes information
useful for end-users, and it also provides information for system
administrators that will help them understand what is enabled for an
end-user when access is granted to a signal or control.</p>
</div>
<div class="section" id="access-management">
<h2>Access Management<a class="headerlink" href="#access-management" title="Permalink to this heading"></a></h2>
<p>Access to signals and controls through the GEOPM Service is configured
by the system administrator.  The administrator controls a default
access list that applies to all users of the system.  This list
may be augmented so that users who are members of particular Unix groups may
have enhanced access.  The default lists are stored in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">-</span><span class="n">service</span><span class="o">/</span><span class="mf">0.</span><span class="n">DEFAULT_ACCESS</span><span class="o">/</span><span class="n">allowed_signals</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">-</span><span class="n">service</span><span class="o">/</span><span class="mf">0.</span><span class="n">DEFAULT_ACCESS</span><span class="o">/</span><span class="n">allowed_controls</span>
</pre></div>
</div>
<p>Each Unix group name <code class="docutils literal notranslate"><span class="pre">&lt;GROUP&gt;</span></code> that has extended permissions can
maintain one or both of the files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">-</span><span class="n">service</span><span class="o">/&lt;</span><span class="n">GROUP</span><span class="o">&gt;/</span><span class="n">allowed_signals</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">geopm</span><span class="o">-</span><span class="n">service</span><span class="o">/&lt;</span><span class="n">GROUP</span><span class="o">&gt;/</span><span class="n">allowed_controls</span>
</pre></div>
</div>
<p>Any missing files are inferred to be empty lists, including the
default access files.  A signal or control will not be available to
non-root users through the GEOPM Service until a system administrator
enables access through these allow lists.  It is recommended that all
manipulation of these files should be done through the GEOPM Service
with the <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line tool.</p>
</div>
<div class="section" id="opening-a-session">
<h2>Opening a Session<a class="headerlink" href="#opening-a-session" title="Permalink to this heading"></a></h2>
<p>A client process opens a session with the GEOPM Service each time a
PlatformIO object is created with libgeopm or libgeopmpolicy while the
GEOPM systemd service is active.  This session is initially opened in
read-only mode.  Calls into the D-Bus APIs that modify control values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">io</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">geopm</span><span class="o">.</span><span class="n">PlatformWriteControl</span>
<span class="n">io</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">geopm</span><span class="o">.</span><span class="n">PlatformPushControl</span>
</pre></div>
</div>
<p>convert the session into write mode.  Only one write mode session is
allowed at any time.  The request will fail if a client attempts to
begin a write session while another client has one open.</p>
<p>When a session is converted to write mode, all controls that the
service is configured to support are recorded to a save directory in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">geopm</span><span class="o">-</span><span class="n">service</span><span class="o">/</span><span class="n">SAVE_FILES</span>
</pre></div>
</div>
<p>When a write mode session ends, all of these saved controls are
restored to the value they had when the session was converted,
regardless of whether or not they were adjusted during the session
through the service.</p>
<p>In addition to saving the state of controls, the GEOPM Service will
also lock access to controls for any other client until the
controlling session ends.  When the controlling session ends the saved
state is used to restore the values for all controls supported by the
GEOPM Service to the values they had prior to enabling the client to
modify a control.  The controlling session may end by an explicit
D-Bus call by the client, or when the process that initiated the
client session ends.  The GEOPM Service will poll procfs for the
process ID.</p>
</div>
<div class="section" id="batch-server">
<h2>Batch Server<a class="headerlink" href="#batch-server" title="Permalink to this heading"></a></h2>
<p>The GEOPM Service provides the implementation for the ServiceIOGroup
which accesses this implementation through the DBus interface.  When a
user program calls <code class="docutils literal notranslate"><span class="pre">read_signal()</span></code> or <code class="docutils literal notranslate"><span class="pre">write_control()</span></code> on a
PlatformIO object provided by libgeopm or libgeopmpolicy and the only
IOGroup that provides the signal or control requested is the
ServiceIOGroup, then each request goes through the slow D-Bus
interface.  When a client process uses the ServiceIOGroup for batch
operations a separate batch server process is created through the D-Bus
interface.  The implementations for <code class="docutils literal notranslate"><span class="pre">push_signal()</span></code> and
<code class="docutils literal notranslate"><span class="pre">push_control()</span></code> are used to configure the stack of signals and
controls that will be enabled by the batch server.  This batch server
interacts more directly with the client process to provide low latency
support for the <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> and <code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> interfaces of the
ServiceIOGroup.</p>
<p>The batch server is configured to allow access to exactly the signals
and controls that were pushed onto the stack for the ServiceIOGroup
prior to the first <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> or <code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> call.
Through the D-Bus implementation, the GEOPM Service verifies that the
client user has appropriate permissions for the requested signals and
controls.  When the first call to <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> or
<code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> is made to user's PlatformIO object, the geopmd
process forks the batch server process and no more updates can be made
to the configured requests.  The batch server uses inter-process
shared memory and FIFO special files to enable fast access to the
configured stack of GEOPM signals and controls.</p>
<p>To implement the <code class="docutils literal notranslate"><span class="pre">read_batch()</span></code> method, the ServiceIOGroup writes a
character to a FIFO to notify the batch server that it would like the
configured GEOPM signals to be updated in shared memory.  The client
process then waits on a FIFO for a message from the server that the
request is ready.  The batch server proceeds to read all GEOPM signals
that are supported by the client's ServiceIOGroup using the batch
server's instance of the PlatformIO object.  GEOPM signals are copied
into the shared memory buffer and when the buffer is ready, a
character is written into the FIFO that the client process is waiting
on.</p>
<p>To implement the <code class="docutils literal notranslate"><span class="pre">write_batch()</span></code> method, the client process's
ServiceIOGroup prepares the shared memory buffer with all control
settings that the batch server is supporting.  The client then writes
a character into a FIFO to notify the batch server that it would like
the configured GEOPM controls to be written.  The client process then
waits on a FIFO for a message from the server that the controls have
been written.  The batch server proceeds to read the clients settings
from the shared memory buffer and writes the values through the server
process's PlatformIO instance.  When the write has completed, a
character is written into the FIFO that the client process is waiting
on.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="service.html" class="btn btn-neutral float-left" title="Guide for Service Users" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="install.html" class="btn btn-neutral float-right" title="Guide to Service Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015 - 2022, Intel Corporation. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>