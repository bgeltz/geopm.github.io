

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Guide for Service Administrators &mdash; GEOPM Service  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Guide for Service Clients" href="client.html" />
    <link rel="prev" title="Building GEOPM Service" href="build.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> GEOPM Service
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">GEOPM Systemd Service and Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building GEOPM Service</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Guide for Service Administrators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-enabling-user-access">Example: Enabling User Access</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Guide for Service Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Guide for HPC Runtime Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Guide for Application Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Manual</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GEOPM Service</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Guide for Service Administrators</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/admin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="guide-for-service-administrators">
<h1>Guide for Service Administrators<a class="headerlink" href="#guide-for-service-administrators" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line tool is used by a system
administrator to manage access to the features provided by the GEOPM
Service.  The GEOPM Service does not allow read or write access for
any non-root user until the system administrator explicitly configures
the service using the <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line tool.  This command
line interface allows the administrator to set access permissions for
all users, and may extend these default privileges for specific Unix
groups.</p>
<div class="section" id="example-enabling-user-access">
<h2>Example: Enabling User Access<a class="headerlink" href="#example-enabling-user-access" title="Permalink to this headline">¶</a></h2>
<p>This test configures the GEOPM service to enable and disable any
user to read and write to bits 8-15 of the MSR_PERF_CTL register
which controls the maximum frequency of the core.  The test saves
the existing settings so they can be restored at the end of the
test.  Access to the control is removed from the list, and it is
shown that the test user cannot succesfully run the
test_write_session.sh script.  Access to the control is granted
and it is shown that the test user can succefully change the
value.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># PARAMETERS</span>
<span class="nv">CONTROL</span><span class="o">=</span>MSR::PERF_CTL:FREQ
<span class="nv">TEST_DIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="k">$(</span>readlink -f <span class="nv">$0</span><span class="k">))</span>
<span class="nv">TEST_USER</span><span class="o">=</span><span class="nb">test</span>
<span class="nv">TEST_SCRIPT</span><span class="o">=</span><span class="si">${</span><span class="nv">TEST_DIR</span><span class="si">}</span>/test_write_session.sh
<span class="nv">SAVE_SIGNALS</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
<span class="nv">SAVE_CONTROLS</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
<span class="nv">TEST_SIGNALS</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
<span class="nv">TEST_CONTROLS</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>

test_error<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;Error: </span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="nb">exit</span> -1
<span class="o">}</span>

<span class="c1"># MAKE SURE TEST IS RUN AS ROOT USER</span>
<span class="nb">test</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">||</span>
    test_error <span class="s2">&quot;Must be run as the root user, this is an administrator test&quot;</span>

<span class="c1"># SAVE INITIAL ACCESS SETTINGS</span>
geopmaccess &gt; <span class="si">${</span><span class="nv">SAVE_SIGNALS</span><span class="si">}</span>
geopmaccess -c &gt; <span class="si">${</span><span class="nv">SAVE_CONTROLS</span><span class="si">}</span>

<span class="c1"># REMOVE CONTROL FROM ACCESS LIST FOR READING AND WRITING</span>
grep -v <span class="si">${</span><span class="nv">CONTROL</span><span class="si">}</span> <span class="si">${</span><span class="nv">SAVE_SIGNALS</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">TEST_SIGNALS</span><span class="si">}</span>
grep -v <span class="si">${</span><span class="nv">CONTROL</span><span class="si">}</span> <span class="si">${</span><span class="nv">SAVE_CONTROLS</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">TEST_CONTROLS</span><span class="si">}</span>
geopmaccess -w &lt; <span class="si">${</span><span class="nv">TEST_SIGNALS</span><span class="si">}</span>
geopmaccess -w -c &lt; <span class="si">${</span><span class="nv">TEST_CONTROLS</span><span class="si">}</span>

<span class="c1"># RUN WRITE SESSION TEST AND MAKE SURE IT FAILS</span>
su <span class="si">${</span><span class="nv">TEST_USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">TEST_SCRIPT</span><span class="si">}</span> <span class="o">&amp;&amp;</span>
    test_error <span class="s2">&quot;Access to </span><span class="nv">$CONTROL</span><span class="s2"> was disabled, but write session passed&quot;</span>

<span class="c1"># ADD THE CONTROL INTO ACCESS LIST FOR READING AND WRITING</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">CONTROL</span><span class="si">}</span> &gt;&gt; <span class="si">${</span><span class="nv">TEST_SIGNALS</span><span class="si">}</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">CONTROL</span><span class="si">}</span> &gt;&gt; <span class="si">${</span><span class="nv">TEST_CONTROLS</span><span class="si">}</span>
geopmaccess -w &lt; <span class="si">${</span><span class="nv">TEST_SIGNALS</span><span class="si">}</span>
geopmaccess -w -c &lt; <span class="si">${</span><span class="nv">TEST_CONTROLS</span><span class="si">}</span>

<span class="c1"># RUN WRITE SESSION TEST AND MAKE SURE IT PASSES</span>
su <span class="si">${</span><span class="nv">TEST_USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">TEST_SCRIPT</span><span class="si">}</span> <span class="o">||</span>
    test_error <span class="s2">&quot;Access to </span><span class="nv">$CONTROL</span><span class="s2"> was enabled, but write session failed&quot;</span>

<span class="c1"># RESTORE INITIAL ACCESS SETTINGS</span>
geopmaccess -w &lt; <span class="si">${</span><span class="nv">SAVE_SIGNALS</span><span class="si">}</span>
geopmaccess -w -c &lt; <span class="si">${</span><span class="nv">SAVE_CONTROLS</span><span class="si">}</span>

<span class="c1"># CLEAN UP TEMPORARY FILES</span>
rm <span class="si">${</span><span class="nv">SAVE_SIGNALS</span><span class="si">}</span> <span class="si">${</span><span class="nv">SAVE_CONTROLS</span><span class="si">}</span> <span class="si">${</span><span class="nv">TEST_SIGNALS</span><span class="si">}</span> <span class="si">${</span><span class="nv">TEST_CONTROLS</span><span class="si">}</span>

<span class="nb">echo</span> <span class="s2">&quot;SUCCESS&quot;</span>
<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="client.html" class="btn btn-neutral float-right" title="Guide for Service Clients" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="build.html" class="btn btn-neutral float-left" title="Building GEOPM Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Intel (R) Corporation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>