<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>geopm::PlatformTopo(3) - platform topology information</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#NAME">NAME</a>
    <a href="#NAMESPACES">NAMESPACES</a>
    <a href="#SYNOPSIS">SYNOPSIS</a>
    <a href="#DESCRIPTION">DESCRIPTION</a>
    <a href="#SINGLETON-ACCESSOR">SINGLETON ACCESSOR</a>
    <a href="#CLASS-METHODS">CLASS METHODS</a>
    <a href="#EXAMPLES">EXAMPLES</a>
    <a href="#COPYRIGHT">COPYRIGHT</a>
    <a href="#SEE-ALSO">SEE ALSO</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>geopm::PlatformTopo(3)</li>
    <li class='tc'></li>
    <li class='tr'>geopm::PlatformTopo(3)</li>
  </ol>

  <h2 id="NAME">NAME</h2>
<p class="man-name">
  <code>geopm::PlatformTopo</code> - <span class="man-whatis">platform topology information</span>
</p>

<h2 id="NAMESPACES">NAMESPACES</h2>

<p>The <code>IPlatformTopo</code> class and <code>platform_topo()</code> singleton accessor
function are members of <code>namespace geopm</code>, but the full names,
<code>geopm::IPlatformTopo</code> and <code>geopm::platform_topo()</code>, have been
abbreviated in this manual.  Similarly, the <code>std::</code> namespace
specifier has been omitted from the interface definitions for the
following standard types: <code>std::vector</code>, <code>std::string</code>, and
<code>std::set</code>, to enable better rendering of this manual.  This manual
sometimes omits the class scope IPlatformTopo:: for brevity.</p>

<p>Note that <code>IPlatformTopo</code> class is an abstract base class that the
user interacts with.  The concrete implementation, <code>PlatformTopo</code>, is
hidden by the singleton accessor.</p>

<h2 id="SYNOPSIS">SYNOPSIS</h2>

<p><strong>#include <a href="https://github.com/geopm/geopm/blob/dev/src/PlatformTopo.hpp">&lt;geopm/PlatformTopo.hpp></a></strong></p>

<p><code>Link with -lgeopm (MPI) or -lgeopmpolicy (non-MPI)</code></p>

<dl>
<dt><code>IPlatformTopo &amp;platform_topo(</code></dt><dd><p><code>void);</code></p></dd>
<dt><code>int IPlatformTopo::num_domain(</code></dt><dd><p><code>int</code> <em>domain_type</em><code>) const = 0;</code></p></dd>
<dt><code>set&lt;int> IPlatformTopo::domain_cpus(</code></dt><dd><p><code>int</code> <em>domain_type</em><code>,</code> <br />
<code>int</code> <em>domain_idx</em><code>) const = 0;</code></p></dd>
<dt><code>int IPlatformTopo::domain_idx(</code></dt><dd><p><code>int</code> <em>domain_type</em><code>,</code> <br />
<code>int</code> <em>cpu_idx</em><code>) const = 0;</code></p></dd>
<dt><code>bool IPlatformTopo::is_domain_within(</code></dt><dd><p><code>int</code> <em>inner_domain</em><code>,</code> <br />
<code>int</code> <em>outer_domain</em><code>) const = 0;</code></p></dd>
<dt><code>static string IPlatformTopo::domain_type_to_name(</code></dt><dd><p><code>int</code> <em>domain_type</em><code>);</code></p></dd>
<dt><code>static int IPlatformTopo::domain_name_to_type(</code></dt><dd><p><code>const std::string &amp;</code><em>domain_name</em><code>);</code></p></dd>
</dl>


<h2 id="DESCRIPTION">DESCRIPTION</h2>

<p>This class describes the number and arrangement of cores, sockets,
logical CPUs, memory banks, and other components.  This information is
used when calling methods of the <strong>geopm::PlatformIO</strong> interface.  The
topology of the current platform is available using the singleton
geopm::platform_topo().  The remaining methods are accessed through
this singleton.</p>

<p>Most methods in the <code>IPlatformTopo</code> interface return or require as an
argument an integer domain type, used to refer to different parts of
the system topology where signals and controls are applicable.  Each
domain is defined by a type and an index.  The domain type is a
value from the <code>m_domain_e</code> enum, and the domain index enumerates the
devices of that type available on the system.  Each domain type is
related to a set of Linux logical CPUs and this can be determined with
the <code>IPlatformTopo::domain_cpus()</code> method.  The CPUs associated with a
domain are the set of CPUs that can most efficiently issue
instructions to read signals from or write controls to that domain.</p>

<p>The available domain types are as follows:</p>

<dl>
<dt>IPlatformTopo::M_DOMAIN_INVALID = 0</dt><dd><p>Indicates an invalid domain.</p></dd>
<dt>IPlatformTopo::M_DOMAIN_BOARD = 1</dt><dd><p>All components on a user allocated compute node. There is only a
single board per compute node, and every other domain is contained
with the board domain.</p></dd>
<dt>IPlatformTopo::M_DOMAIN_PACKAGE = 2</dt><dd><p>A collection of all the hardware present on a single processor
package installed on a distinct socket of a motherboard.</p></dd>
<dt>IPlatformTopo::M_DOMAIN_CORE = 3</dt><dd><p>Physical core, i.e. a group of associated hyper-threads</p></dd>
<dt>IPlatformTopo::M_DOMAIN_CPU = 4</dt><dd><p>Linux logical CPU.  In practice, there is one logical CPU per
hyperthread visible to the operating system.</p></dd>
<dt>IPlatformTopo::M_DOMAIN_BOARD_MEMORY = 5</dt><dd><p>Standard off-package DIMM (DRAM or NAND).</p></dd>
<dt>IPlatformTopo::M_DOMAIN_PACKAGE_MEMORY = 6</dt><dd><p>On-package memory (MCDRAM).</p></dd>
<dt>IPlatformTopo::M_DOMAIN_BOARD_NIC = 7</dt><dd><p>Peripheral network interface controller not on the processor package.</p></dd>
<dt>IPlatformTopo::M_DOMAIN_PACKAGE_NIC = 8</dt><dd><p>Network interface controller on the processor package.</p></dd>
<dt>IPlatformTopo::M_DOMAIN_BOARD_ACCELERATOR = 9</dt><dd><p>Peripheral accelerator card not on the processor package.</p></dd>
<dt>IPlatformTopo::M_DOMAIN_PACKAGE_ACCELERATOR = 10</dt><dd><p>Accelerator unit on the package (e.g on-package graphics).</p></dd>
<dt>IPlatformTopo::M_NUM_DOMAIN = 11</dt><dd><p>The number of built-in domains.</p></dd>
</dl>


<h2 id="SINGLETON-ACCESSOR">SINGLETON ACCESSOR</h2>

<dl>
<dt><code>platform_topo</code>()</dt><dd>Returns the singleton accessor for the IPlatformTopo interface.</dd>
</dl>


<h2 id="CLASS-METHODS">CLASS METHODS</h2>

<dl>
<dt><code>num_domain</code>()</dt><dd><p>Number of domains on the platform of a particular <em>domain_type</em>.
Refer to the list of domain types below.</p></dd>
<dt><code>domain_cpus</code>()</dt><dd><p>Get the set of Linux logical CPUs associated with the scope of
<em>domain_type</em> at <em>domain_idx</em>.</p></dd>
<dt><code>domain_idx</code>()</dt><dd><p>Get the domain index for a particular <em>domain_type</em> that contains
the given Linux logical CPU with index <em>cpu_idx</em>.</p></dd>
<dt><code>is_domain_within</code>()</dt><dd><p>Check if <em>inner_domain</em> is contained within <em>outer_domain</em>.
M_DOMAIN_BOARD is the outermost domain representing the entire
node.  All other domains are contained within <em>board</em>.
M_DOMAIN_CORE, M_DOMAIN_CPU, M_DOMAIN_PACKAGE_MEMORY, and
M_DOMAIN_PACKAGE_ACCELERATOR are contained within package.
M_DOMAIN_CPU is contained within M_DOMAIN_CORE.  The following
outline summarizes the hierarchy of containing domains, where each
domain is also contained in parents of its parent domain.</p></dd>
</dl>


<pre><code>    `M_DOMAIN_BOARD`
     +---`M_DOMAIN_PACKAGE`
          +---`M_DOMAIN_CORE`
               +---`M_DOMAIN_CPU`
          +---`M_DOMAIN_PACKAGE_MEMORY`
          +---`M_DOMAIN_PACKAGE_NIC`
          +---`M_DOMAIN_PACKAGE_ACCELERATOR`
     +---`M_DOMAIN_BOARD_MEMORY`
     +---`M_DOMAIN_BOARD_NIC`
     +---`M_DOMAIN_BOARD_ACCELERATOR`
</code></pre>

<dl>
<dt><code>domain_type_to_name</code>()</dt><dd><p>Convert a <em>domain_type</em> integer to a string.  These strings are
used by the <strong><a class="man-ref" href="geopmread.1.html">geopmread<span class="s">(1)</span></a></strong> and <a class="man-ref" href="geopmwrite.1.html">geopmwrite<span class="s">(1)</span></a>** tools.</p></dd>
<dt><code>domain_name_to_type</code>()</dt><dd><p>Convert a <em>domain_name</em> string to the corresponding integer domain type.
This method is the inverse of domain_type_to_name().</p></dd>
</dl>


<h2 id="EXAMPLES">EXAMPLES</h2>

<p>The following example program queries the IPlatformTopo to calculate various
information of interest about the platform.</p>

<pre><code>#include &lt;iostream>

#include &lt;geopm/PlatformTopo.hpp&gt;

using geopm::IPlatformTopo;

int main() {
    IPlatformTopo &amp;topo = geopm::platform_topo();

    int num_cores = topo.num_domain(IPlatformTopo::M_DOMAIN_CORE);
    int num_cpus = topo.num_domain(IPlatformTopo::M_DOMAIN_CPU);
    int num_pkgs = topo.num_domain(IPlatformTopo::M_DOMAIN_PACKAGE);

    // Print counts of various domains
    std::cout &lt;&lt; "Domain      Count      " &lt;&lt; std::endl;
    std::cout &lt;&lt; "-----------------------" &lt;&lt; std::endl;
    std::cout &lt;&lt; "cores       " &lt;&lt; num_cores &lt;&lt; std::endl;
    std::cout &lt;&lt; "packages    " &lt;&lt; num_pkgs &lt;&lt; std::endl;
    std::cout &lt;&lt; "core/pkg    " &lt;&lt; num_cores / num_pkgs &lt;&lt; std::endl;
    std::cout &lt;&lt; "cpu/core    " &lt;&lt; num_cpus / num_cores &lt;&lt; std::endl;
    std::cout &lt;&lt; "cpu/pkg     " &lt;&lt; num_cpus / num_pkgs &lt;&lt; std::endl;
}
</code></pre>

<p>For example, when run on a system with 2 sockets, 4 cores per socket,
and 3 hyperthreads per core, the following would be printed to
standard output:</p>

<pre><code>    Domain      Count
    -----------------------
    cores       8
    packages    2
    core/pkg    4
    cpu/core    3
    cpu/pkg     12
</code></pre>

<p>This loop, inserted into the above program, prints the Linux CPUs on each package:</p>

<pre><code>    for (int pkg_idx = 0; pkg_idx &lt; num_pkgs; ++pkg_idx) {
        std::cout &lt;&lt; "CPUs on package " &lt;&lt; pkg_idx &lt;&lt; ": ";
        std::set&lt;int> cpus = topo.domain_cpus(IPlatformTopo::M_DOMAIN_PACKAGE, pkg_idx);
        for(auto pcpu : cpus) {
            std::cout &lt;&lt; pcpu &lt;&lt; " ";
        }
        std::cout &lt;&lt; std::endl;
    }
</code></pre>

<p>The output for the same system would be:</p>

<pre><code>CPUs on package 0: 0 1 2 3 8 9 10 11 16 17 18 19
CPUs on package 1: 4 5 6 7 12 13 14 15 20 21 22 23
</code></pre>

<p>To check which logical CPUs are on the same core as CPU 8:</p>

<pre><code>    int my_cpu = 8;
    int cpu_core = topo.domain_idx(IPlatformTopo::M_DOMAIN_CORE, my_cpu);
    std::set&lt;int> socket_cpu_set = topo.domain_cpus(IPlatformTopo::M_DOMAIN_CORE, cpu_core);
    for (auto cpu : socket_cpu_set) {
        if (cpu != my_cpu) {
            std::cout &lt;&lt; cpu &lt;&lt; " ";
        }
    }
    std::cout &lt;&lt; std::endl;
</code></pre>

<p>The output for the same system would be:  0 16</p>

<p>The number of domains can also be use to check if a hardware feature, such as
on-package memory, is present or absent:</p>

<pre><code>    if (topo.num_domain(IPlatformTopo::M_DOMAIN_PACKAGE_MEMORY) &gt; 0) {
        std::cout &lt;&lt; "On-package memory is present." &lt;&lt; std::endl;
    }
    else {
        std::cout &lt;&lt; "No on-package memory." &lt;&lt; std::endl;
    }
</code></pre>

<h2 id="COPYRIGHT">COPYRIGHT</h2>

<p>Copyright (c) 2015, 2016, 2017, 2018, Intel Corporation. All rights reserved.</p>

<h2 id="SEE-ALSO">SEE ALSO</h2>

<p><strong><a class="man-ref" href="geopm.7.html">geopm<span class="s">(7)</span></a></strong>,
<strong><a class="man-ref" href="GEOPM_CXX_MAN_PlatformIO.3.html">geopm::PlatformIO<span class="s">(3)</span></a></strong></p>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'>Intel Corporation</li>
    <li class='tc'>December 2018</li>
    <li class='tr'>geopm::PlatformTopo(3)</li>
  </ol>

  </div>
</body>
</html>
