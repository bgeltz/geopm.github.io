<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guide to Service Security &mdash; GEOPM  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Guide for Service Administrators" href="admin.html" />
    <link rel="prev" title="Guide to Source Builds" href="build.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> GEOPM
            <img src="https://geopm.github.io/images/geopm-logo-clear.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="service.html">Guide for Service Users</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="service_readme.html">GEOPM Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Guide to Service Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="requires.html">Guide to Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="build.html">Guide to Source Builds</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Guide to Service Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#high-level-security-objectives">High Level Security Objectives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fine-grained-access-management-for-hardware-features">Fine-grained access management for hardware features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restore-control-configuration-after-a-writing-session-ends">Restore control configuration after a writing session ends</a></li>
<li class="toctree-l4"><a class="reference internal" href="#one-writing-geopm-session-allowed-at-any-time">One writing GEOPM session allowed at any time</a></li>
<li class="toctree-l4"><a class="reference internal" href="#provide-a-low-latency-interface">Provide a low latency interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#secure-restart-of-the-geopmd-daemon-process">Secure restart of the <code class="docutils literal notranslate"><span class="pre">geopmd</span></code> daemon process</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#secure-interfaces">Secure Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-software-dependencies">Secure Software Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#protected-assets">Protected Assets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#model-specific-register-device-driver">Model Specific Register device driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="#intel-speed-select-device-driver">Intel Speed Select device driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="#levelzero-sysman-library-interface">LevelZero sysman library interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nvidia-nvml-device-management-library-interface">Nvidia NVML device management library interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#service-user-data">Service user data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#attack-surface">Attack Surface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#system-files">System files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inter-process-shared-memory">Inter-process shared memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fifo-special-files">FIFO special files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#systemd-dbus-interface">Systemd DBus interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logging">Logging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#security-threats">Security Threats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#malicious-input-or-private-output">Malicious input or private output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-usage-configuration">File usage/configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#external-dependencies">External dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="admin.html">Guide for Service Administrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="client.html">Guide for Service Clients</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Guide for Runtime Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Guide for Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel.html">Guide for GEOPM Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Manual</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GEOPM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="service.html">Guide for Service Users</a> &raquo;</li>
      <li>Guide to Service Security</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/security.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="guide-to-service-security">
<h1>Guide to Service Security<a class="headerlink" href="#guide-to-service-security" title="Permalink to this heading"></a></h1>
<p>This documentation describes the objectives, mechanisms, assets and
threats that were considered when designing the GEOPM Service security
architecture.  This information may be useful for system
administrators, developers, and users who would like to better
understand how the GEOPM Service provides security guarantees.</p>
<div class="section" id="high-level-security-objectives">
<h2>High Level Security Objectives<a class="headerlink" href="#high-level-security-objectives" title="Permalink to this heading"></a></h2>
<p>The GEOPM Service provides a secure gateway to privileged hardware
features. This section describes the security expectations of the
system administrator who deploys and configures the GEOPM Service as
described in the GEOPM documentation.</p>
<div class="section" id="fine-grained-access-management-for-hardware-features">
<h3>Fine-grained access management for hardware features<a class="headerlink" href="#fine-grained-access-management-for-hardware-features" title="Permalink to this heading"></a></h3>
<p>The GEOPM Service provides a user gateway to privileged system
software interfaces. In general, these system software interfaces have
other Linux mechanisms for system administrators to grant or deny user
access.  The GEOPM Service improves upon other available Linux
security mechanisms by combining fine-grained access management, ease
of extension, and an optional high performance interface. Alternative
options available tend to be more course-grained, less performant, or
more difficult to extend.</p>
<p>Some features of existing device drivers may be enabled for
end users by changing file permissions, however this does not allow
for filtering of which driver features will be available, and is often
insufficient due to Linux
<a class="reference external" href="https://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities(7)</a>
requirements.</p>
<p>Granting Linux capabilities to a helper command line tool or adding a
command line tool to the
<a class="reference external" href="https://man7.org/linux/man-pages/man5/sudoers.5.html">sudoers(5)</a>
configuration is a common way to filter which secure features are
enabled.  These command line tools may also require independent
security review and typically do not provide a high performance
programmatic solution.</p>
<p>High performance security solutions tend to require modifications to
Linux kernel code through either a specialized driver, or through the
insertion of <a class="reference external" href="https://ebpf.io">eBPF</a> programs.  These solutions
require installation of custom tools into the Linux kernel that may
require independent security review by administrators.  The developers
and security experts must have specialized knowledge of the kernel or
eBPF development environment.  Errors and security vulnerabilities in
these filtering and device driver implementations may be more
difficult to identify.</p>
<p>The GEOPM Service provides the system administrator with fine-grained
access management for individual hardware features for a variety of
hardware interfaces. Access to each individual feature provided by a
system software interface may be granted to individual users, or to
Unix user groups, or to all users of the system.  The hardware
interfaces may be expanded through the <code class="docutils literal notranslate"><span class="pre">IOGroup</span></code> C++ plugin
interface.</p>
<p>Each hardware feature that may be read is referred to as a &quot;signal&quot;
and mapped to a specific string name. Each hardware feature that may
be written is referred to as a &quot;control&quot; and is mapped to a specific
string name. These signals and controls are represented as double
precision floating point numbers in SI units. Requests to GEOPM
interfaces to read a signal or write a control are combined with a
hardware domain and a domain index.  The hardware domain specifies the
type of hardware component and the domain index identifies the
specific component where the request will be applied.</p>
<p>The GEOPM Service does not provide user access to any signals or
controls until a system administrator grants this access; this follows
the &quot;Secure by Default&quot; design. All available signals and controls are
documented, and the description includes the security implications of
granting access. The <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line tool is used by a
system administrator to query descriptions of signals and controls
available on a system as well as managing user access to each feature
by name.</p>
</div>
<div class="section" id="restore-control-configuration-after-a-writing-session-ends">
<h3>Restore control configuration after a writing session ends<a class="headerlink" href="#restore-control-configuration-after-a-writing-session-ends" title="Permalink to this heading"></a></h3>
<p>Users are not allowed to make persistent changes to hardware settings
using the GEOPM Service. The lifetime of configuration changes made
through the GEOPM Service is limited to the lifetime of the writing
PID's process session.  To learn more about the Linux process session
interface see the
<a class="reference external" href="https://man7.org/linux/man-pages/man2/setsid.2.html">setsid(2)</a>
man page.  Typically the process session is coupled to a controlling
terminal.</p>
<p>The GEOPM Service implements this feature by saving all control
configuration settings to disk prior to enabling a user session to
write. When the user's write session terminates, all configuration
settings are restored to their previous value. The storage location
for the saved state is in the directory
<code class="docutils literal notranslate"><span class="pre">/run/geopm-service/SAVE_FILES</span></code>.</p>
<p>Note that all configuration settings are restored regardless of
whether or not they were adjusted during the session through the
service.</p>
</div>
<div class="section" id="one-writing-geopm-session-allowed-at-any-time">
<h3>One writing GEOPM session allowed at any time<a class="headerlink" href="#one-writing-geopm-session-allowed-at-any-time" title="Permalink to this heading"></a></h3>
<p>The GEOPM Service enforces that at most one writing user session is
supported at any time.  This restriction enables the save/restore
methodology outlined in the previous section to be effective. The
write lock that enables this mutual exclusion is associated with the
Unix &quot;process session leader&quot; PID of the requesting process. If this
session leader PID does not refer to an active process, then the lock
is associated with the requesting process PID. Otherwise, any PID
within the requesting Unix process session is enabled to write through
the GEOPM Service for the duration of the process session leader PID
lifetime.</p>
</div>
<div class="section" id="provide-a-low-latency-interface">
<h3>Provide a low latency interface<a class="headerlink" href="#provide-a-low-latency-interface" title="Permalink to this heading"></a></h3>
<p>The GEOPM Service provides a batch interface that allows users to
configure a server process.  The batch server process is forked by
<code class="docutils literal notranslate"><span class="pre">geopmd</span></code> which is the primary GEOPM Service daemon process started
by
<a class="reference external" href="https://man7.org/linux/man-pages/man1/systemd.1.html">systemd(1)</a>.
The user configures the batch server with an array of requests through
DBus. The access permissions are checked when the call to start the
server is made, and the server is only forked if the client has
permission for all requests in the array. The batch server creates one
or two inter-process shared memory regions to interact with the
client: one region provides a user interface to read signals, and the
other if requested provides a user interface to write
controls. Requests to read, write, or quit are made through a FIFO
channel connecting the client to the batch server, and a second FIFO
is used to communicate to the client when requests have been
completed. These FIFOs are opened in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> which by default systemd
creates as a <a class="reference external" href="https://man7.org/linux/man-pages/man5/tmpfs.5.html">tmpfs(5)</a>.</p>
</div>
<div class="section" id="secure-restart-of-the-geopmd-daemon-process">
<h3>Secure restart of the <code class="docutils literal notranslate"><span class="pre">geopmd</span></code> daemon process<a class="headerlink" href="#secure-restart-of-the-geopmd-daemon-process" title="Permalink to this heading"></a></h3>
<p>All state that is required to maintain the security guarantees of the
GEOPM Service are stored to disk in a secure way (see
<a class="reference internal" href="#file-usage-configuration"><span class="std std-ref">File usage/configuration</span></a>
for more details).  This information is read from disk when the
<code class="docutils literal notranslate"><span class="pre">geopmd</span></code> daemon process begins. This enables the service to cleanly
recover from any premature ending of the daemon process. The restart
of the daemon process is enabled by the systemd Linux service though a
configuration option that the GEOPM Service provides. These options
enable the GEOPM Service to be restarted immediately, and to attempt
to restart twice in rapid succession if necessary. The first attempt
may be used to provide a clean environment for the second restart.</p>
</div>
</div>
<div class="section" id="secure-interfaces">
<h2>Secure Interfaces<a class="headerlink" href="#secure-interfaces" title="Permalink to this heading"></a></h2>
<p>The interfaces that enable a user to access privileged system
resources through the GEOPM Service are limited to the GEOPM DBus
interface published on the system bus at <code class="docutils literal notranslate"><span class="pre">io.github.geopm</span></code>. Using
this interface may enable the creation of a batch server. The access
rights of this batch server are verified prior to its creation, and
the user may then interact with this batch server through faster
mechanisms than DBus provides. In particular, the user interfaces with
the batch server over inter-process shared memory and FIFO special files,
both of which are created in <code class="docutils literal notranslate"><span class="pre">/run/geopm-service</span></code>.</p>
<p>The DBus interface provides a layer of security that is leveraged
throughout Linux services to verify the user identity of requests made
to daemon processes. The GEOPM Service relies on the systemd DBus
interface to provide the PID, UID, and GID of the requesting client.
These identifiers are then used with standard system calls to enforce
access permissions defined by a system administrator.</p>
</div>
<div class="section" id="secure-software-dependencies">
<h2>Secure Software Dependencies<a class="headerlink" href="#secure-software-dependencies" title="Permalink to this heading"></a></h2>
<p>The GEOPM Service relies on external software packages to support
security objectives. These external packages enable secure use of the
DBus interface to systemd and provide standard methods for verifying
JSON data.</p>
<ol class="arabic simple">
<li><p>GEOPM Service DBus Interface</p>
<ol class="loweralpha simple">
<li><p>dasbus &gt;= 1.6</p></li>
<li><p>libsystemd.so / systemd service &gt; 234</p></li>
<li><p>PyGObject &gt;= 3.34.0</p></li>
</ol>
</li>
<li><p>GEOPM Service Input/Output Validation</p>
<ol class="loweralpha simple">
<li><p>jsonschema &gt;= 2.6.0</p></li>
<li><p>json11 &gt;= 1.0.0</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="protected-assets">
<h2>Protected Assets<a class="headerlink" href="#protected-assets" title="Permalink to this heading"></a></h2>
<p>The GEOPM Service provides a security gateway to privileged hardware
interfaces. These interfaces expose power and energy management
features as well as hardware monitoring features such as reading
performance counters. The secure system software interfaces that are
available through the GEOPM Service are described in this
section. These interfaces may also be expanded by using the GEOPM
IOGroup plugin interface.</p>
<p>The GEOPM Service provides the <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code> command line interface
for system administrators to manage access to hardware features. This
interface is expected to be a reliable and secure mechanism for
managing access rights of users to the assets described in this
section.  Maintaining user privacy such that client interactions with
the GEOPM service are not observable to other users is also a security
priority.</p>
<div class="section" id="model-specific-register-device-driver">
<h3>Model Specific Register device driver<a class="headerlink" href="#model-specific-register-device-driver" title="Permalink to this heading"></a></h3>
<p>The GEOPM Service may be used as a gateway to the x86 Model Specific
Register device driver
<a class="reference external" href="https://man7.org/linux/man-pages/man4/msr.4.html">msr(4)</a>
which is loaded as the <code class="docutils literal notranslate"><span class="pre">/dev/cpu/*/msr</span></code> devices.  There are many
features available through the MSR device driver, and the GEOPM
Service provides access to a subset of these features. The features
supported by the GEOPM Service are focused on power and energy
management as well as performance monitoring. Some examples are
reading instruction counters or setting limits on CPU core operating
frequency.</p>
<p>Direct access to the MSR driver is restricted as this may enable users
to obtain information about processes they do not own or impact system
performance for other users. For these reasons using the MSR driver
requires the CAP_SYS_RAWIO Linux
<a class="reference external" href="https://man7.org/linux/man-pages/man7/capabilities.7.html">capability</a>.</p>
<p>The GEOPM Service access management system allows a system
administrator to control precisely which subset of features available
through the MSR driver may be accessed. Additionally, the GEOPM
Service does not allow persistent changes to the MSR driver. For these
reasons a system administrator may wish to provide MSR access through
the GEOPM Service to processes that do not have the CAP_SYS_RAWIO
Linux
<a class="reference external" href="https://man7.org/linux/man-pages/man7/capabilities.7.html">capability</a>.</p>
</div>
<div class="section" id="intel-speed-select-device-driver">
<h3>Intel Speed Select device driver<a class="headerlink" href="#intel-speed-select-device-driver" title="Permalink to this heading"></a></h3>
<p>The GEOPM Service may be used as a gateway to the Intel Speed Select
device driver which is loaded as the <code class="docutils literal notranslate"><span class="pre">/dev/isst_interface</span></code>
device. This device driver enables a wide range of capabilities
introduced with the 3rd generation Xeon Scalable server processor.</p>
<p><a class="reference external" href="https://www.kernel.org/doc/html/latest/admin-guide/pm/intel-speed-select.html">https://www.kernel.org/doc/html/latest/admin-guide/pm/intel-speed-select.html</a></p>
<p>The specific features enabled through the GEOPM Service are the
<a class="reference external" href="https://www.kernel.org/doc/html/latest/admin-guide/pm/intel-speed-select.html#intel-r-speed-select-technology-core-power-intel-r-sst-cp">SST-CP</a>
and
<a class="reference external" href="https://www.kernel.org/doc/html/latest/admin-guide/pm/intel-speed-select.html#intel-r-speed-select-technology-turbo-frequency-intel-r-sst-tf">SST-TF</a>
features. Using the <code class="docutils literal notranslate"><span class="pre">isst_interface</span></code> device driver requires the
Linux
<a class="reference external" href="https://man7.org/linux/man-pages/man7/capabilities.7.html">capability</a>
of CAP_SYS_ADMIN because changes may impact system performance for
other users of the system. The ISST interface may also be used to
change the hardware characteristics reported by the Linux kernel, such
as number of cores, base frequency, and which turbo frequencies are
achievable.</p>
</div>
<div class="section" id="levelzero-sysman-library-interface">
<h3>LevelZero sysman library interface<a class="headerlink" href="#levelzero-sysman-library-interface" title="Permalink to this heading"></a></h3>
<p>The LevelZero sysman library interface enables users to monitor and
control Intel GPU devices. These signals and controls include
setting bounds on GPU operating frequency and reading performance
counters from GPU devices. Access to the LevelZero sysman interface is
restricted because it provides ability to modify the performance of
the system and direct access to hardware metrics that reflect user
activity.</p>
</div>
<div class="section" id="nvidia-nvml-device-management-library-interface">
<h3>Nvidia NVML device management library interface<a class="headerlink" href="#nvidia-nvml-device-management-library-interface" title="Permalink to this heading"></a></h3>
<p>The NVML library interface enables users to monitor and control Nvidia
GPU devices. These controls and monitors include setting bounds on GPU
operating frequency and reading performance counters from GPU devices.
Access to some of the interfaces of the NVML library are restricted
and some of those restrictions may be relaxed based on settings
enabled by a system administrator.</p>
</div>
<div class="section" id="service-user-data">
<h3>Service user data<a class="headerlink" href="#service-user-data" title="Permalink to this heading"></a></h3>
<p>Interactions with the GEOPM Service by each client are private
information and an asset that the GEOPM Service is designed to
protect.  Unprivileged users of the system should not be able to
observe the calls, inputs, or outputs to the GEOPM Service by other
users of the system.</p>
</div>
</div>
<div class="section" id="attack-surface">
<h2>Attack Surface<a class="headerlink" href="#attack-surface" title="Permalink to this heading"></a></h2>
<p>This section describes the interfaces that must be protected to ensure
the security requirements of the GEOPM Service.</p>
<div class="section" id="system-files">
<h3>System files<a class="headerlink" href="#system-files" title="Permalink to this heading"></a></h3>
<p>The state used to manage access permissions, track open sessions, and
store control settings for reset is stored in system files. The files
controlling access permissions are located in the
<code class="docutils literal notranslate"><span class="pre">/etc/geopm-service</span></code> directory. The state required to support active
user sessions is stored in <code class="docutils literal notranslate"><span class="pre">/run/geopm-service</span></code>. Protecting
these files is paramount to the integrity of the GEOPM Service
security model.  In general these files have root access permissions
only, and are modified by calling into GEOPM Service interfaces, or by
running GEOPM Service command line tools like <code class="docutils literal notranslate"><span class="pre">geopmaccess</span></code>.</p>
</div>
<div class="section" id="inter-process-shared-memory">
<h3>Inter-process shared memory<a class="headerlink" href="#inter-process-shared-memory" title="Permalink to this heading"></a></h3>
<p>The batch server interface of the GEOPM Service uses POSIX
inter-process shared memory to communicate telemetry and
configurations with a user processes. For each batch session opened by
a user process there are one or two shared memory regions opened for
communication. Protecting the integrity of these shared system
resources is a critical part of our security model. Access to these
shared memory regions by a user other than the client can result in
escalation of privileges, and subversion of the administrative access
lists.</p>
</div>
<div class="section" id="fifo-special-files">
<h3>FIFO special files<a class="headerlink" href="#fifo-special-files" title="Permalink to this heading"></a></h3>
<p>In conjunction with the inter-process shared memory, there are FIFO
special files created in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>, the temporary file system, to
support the batch server features of the GEOPM Service. Notifications
sent between the client and server about updates to data in
inter-process shared memory go across the FIFOs which serve as a
synchronization mechanism.  Adversarial access to these files could
cause deadlocks in the batch server or client process or enable
information about the client session requests to be observed.</p>
</div>
<div class="section" id="systemd-dbus-interface">
<h3>Systemd DBus interface<a class="headerlink" href="#systemd-dbus-interface" title="Permalink to this heading"></a></h3>
<p>The systemd DBus implementation is a standard Linux interface for
secure communication with Linux system services.  The
<a class="reference external" href="https://man7.org/linux/man-pages/man3/sd-bus.3.html">sd-bus(3)</a>
DBus interface of the Linux systemd service provides the mechanism for
users to securely exchange requests and results with the GEOPM
Service. The DBus interface also enables the GEOPM Service to securely
identify the source of client requests. The GEOPM implementation uses
the
<a class="reference external" href="https://dasbus.readthedocs.io/en/stable/index.html" title="(in dasbus)"><span class="xref std std-doc">dasbus</span></a>
and
<a class="reference external" href="https://pygobject.readthedocs.io/en/latest/index.html" title="(in PyGObject)"><span class="xref std std-doc">PyGObject</span></a>
Python modules to implement the server side of the GEOPM DBus
interface in Python, while it uses the libsystemd.so to implement a C
interface to the client side of the GEOPM DBus interface directly with
the
<a class="reference external" href="https://man7.org/linux/man-pages/man3/sd-bus.3.html">sd-bus(3)</a>
interface.  The GEOPM Service relies on these standard Linux tools to
provide a trusted interface and a secured attack surface.</p>
</div>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this heading"></a></h3>
<p>GEOPM's implementation ensures that GEOPM has sufficient logging to
provide traceability to system administrators about user
interactions. This includes logging of security critical events (e.g.
user interactions that result in changing the system configuration),
avoiding excessive logging, avoiding public logging of private
information and ensuring logs are reliable.</p>
<p>The GEOPM Service has the capability of writing to the logging service
provided by <code class="docutils literal notranslate"><span class="pre">dasbus</span></code>. Most commonly this is the logging capabilities
provided by systemd, and are accessible via the journalctl command
(e.g.  journalctl -u geopm) or through inspection of
<code class="docutils literal notranslate"><span class="pre">/var/log/messages</span></code> or similar ways of viewing the <code class="docutils literal notranslate"><span class="pre">syslog</span></code> which
may depend on how the system is configured.</p>
<p>The GEOPM Service will log any error conditions that arise from
attempting to set up or use configuration files stored in a secure
location.  See
<a class="reference internal" href="#system-files"><span class="std std-ref">System files</span></a>
for more information about these secure files.</p>
</div>
</div>
<div class="section" id="security-threats">
<h2>Security Threats<a class="headerlink" href="#security-threats" title="Permalink to this heading"></a></h2>
<p>This section enumerates the mechanisms that an adversary may use in an
attempt to breach the attack surface to subvert the security
guarantees of the GEOPM Service. Each threat is split out into its own
subsection.  The threat is described in the context of how the
mechanism might be used against the GEOPM Service attack surface, and
how the surface is secured against this threat.</p>
<div class="section" id="malicious-input-or-private-output">
<h3>Malicious input or private output<a class="headerlink" href="#malicious-input-or-private-output" title="Permalink to this heading"></a></h3>
<p>Each GEOPM Service interface that may be accessed by an unprivileged
user is a threat vector.  All input received from the user is
validated to ensure no malicious or malformed data is used in any way
that may result in a compromised or misconfigured system. All output
from these interfaces is vetted to ensure that the service does not
emit private, malicious, or malformed data.</p>
<p>The GEOPM Service provides two interfaces for end users.  One is the
<code class="docutils literal notranslate"><span class="pre">io.github.geopm</span></code> DBus interface published through systemd.  The
other is the batch server interface which may be created with a
request to the GEOPM DBus interface.  The batch server is accessed by
the end user through inter-process shared memory, and FIFO special
files in the temporary file system.</p>
</div>
<div class="section" id="file-usage-configuration">
<h3>File usage/configuration<a class="headerlink" href="#file-usage-configuration" title="Permalink to this heading"></a></h3>
<p>As GEOPM reads and writes configuration files to disk, it is important
to validate that the file usage is done as securely as possible. This
includes verifying an input file is not a symbolic link to an
unintended resource, verifying that all temporary files are cleaned up
properly, and that the temporary files and directories that are used
do not have excessive permissions.</p>
<p>The GEOPM Service utilizes files on disk to support several behaviors
including facilitating user/group access to privileged
signals/controls, storing state information about in-progress client
sessions, and saving the initial state of hardware controls so that
any control changes may be reverted. GEOPM utilizes temporary files
and move semantics to ensure that files written to the secure
locations previously described are complete and have valid data.</p>
<p>GEOPM mitigates threats in this space by performing several checks on
any files/directories used for input. Note that there are no user
facing APIs provided by the GEOPM Service that take paths as
input. All directory paths used in the GEOPM Service are statically
defined in the source code.</p>
<p>A secure API for dealing with files and directories resides in
<a class="reference external" href="https://github.com/geopm/geopm/blob/dev/service/geopmdpy/system_files.py">system_files.py</a>.
The functions that match the pattern system_files.secure_*() are the
only interfaces called by the GEOPM Service to access files located in
<code class="docutils literal notranslate"><span class="pre">/etc</span></code> and <code class="docutils literal notranslate"><span class="pre">/run</span></code>. These secure functions are used to make
directories and any input or output to these system files.</p>
<p>When making directories, if the path already exists checks are
performed to ensure: the path is a regular directory, the path is not
a link, the path is accessible by the caller, the path is owned by the
calling process UID/GID, and the permissions on the directory are set
to the right permissions (chosen to be as restrictive as possible). If
the path is determined to be insecure, the existing path is renamed to
indicate it is invalid and preserved for later auditing. In this case
a new directory will be created at the specified path. If the path did
not already exist, a new directory is created with the proper
permissions.</p>
<p>By default, directories are created with 0o700 permissions (i.e. rwx
only for the owner). Some directories, for example
<code class="docutils literal notranslate"><span class="pre">/run/geopm-service</span></code>, also require execution permissions (i.e.
0o711). For more details on how directories are created and default
permissions, please see the <a class="reference internal" href="geopmdpy.7.html#module-geopmdpy.system_files"><span class="std std-ref">system_files.py</span></a>
documentation</p>
<p>When making files, a temporary file is first created with 0o600 or
owner rw only permissions. The desired contents are then written to
this temporary file. Once writing is complete, the temporary file is
renamed to the desired path while preserving the 0o600
permissions. This rename is atomic, so it is not possible for files to
exist with partial/corrupt data. Any existing file at the desired
location will be overwritten.</p>
<p>When reading files, first the path's security is verified.  The
implementation asserts that the path describes an existing regular
file which is not a link nor a directory.  After the path is verified,
a file descriptor is opened referencing the path and this file
descriptor's security is verified.  The implementation asserts that
the descriptor refers to a regular file owned by the calling process
UID/GID and that the file descriptor has minimal permissions
(i.e. 0o600 or rw for the owner only).  After these assertions have
been made, the implementation reads the entire file contents into a
string buffer and the file descriptor is closed.</p>
</div>
<div class="section" id="external-dependencies">
<h3>External dependencies<a class="headerlink" href="#external-dependencies" title="Permalink to this heading"></a></h3>
<p>The GEOPM Service utilizes shared libraries to facilitate user plugins
of the IOGroups and Agents. The service expects the plugins to reside
in a particular path on disk that can only be set by the system
administrator. If valid shared objects reside in the prescribed
location, they will be loaded at service startup and utilized if
requested by the user. The expectation is that a system administrator
would set the plugin path and only place vetted plugins there if
needed.  The GEOPM Service is a systemd service unit which is
configured through the
<a class="reference external" href="https://man7.org/linux/man-pages/man5/systemd.service.5.html">systemd.service(5)</a>
file.  The configuration file provided with the GEOPM source code,
<a class="reference external" href="https://github.com/geopm/geopm/blob/dev/service/geopm.service">geopm.service</a>,
does not export the <code class="docutils literal notranslate"><span class="pre">GEOPM_PLUGIN_PATH</span></code> environment variable before
launching <code class="docutils literal notranslate"><span class="pre">geopmd</span></code>, so this feature is disabled by default.</p>
<p>GEOPM makes use of third-party JSON libraries in the C/C++ runtime,
and several Python modules in the case of the GEOPM Service. Through
the course of the nightly integration testing of GEOPM, the latest
released versions of all external Python modules are installed via
pip. If any issues arise, reports are automatically generated to
detail the failure and are sent to the developers. For the C/C++ JSON
usage, the upstream repository is periodically checked to ensure the
code that resides in GEOPM is up-to-date.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build.html" class="btn btn-neutral float-left" title="Guide to Source Builds" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="admin.html" class="btn btn-neutral float-right" title="Guide for Service Administrators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015 - 2023, Intel Corporation. All rights reserved..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>